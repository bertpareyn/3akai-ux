casper.test.comment('Widget - Comments');

/**
 * Verifies that all elements in the comments widget are present
 */
var verifyCommentsElements = function() {
    // Verify that the form exists
    casper.test.assertExists('.comments-new-comment-form', 'The comments form is present');
    // Verify the textarea in the form exists
    casper.test.assertExists('.comments-new-comment-form textarea#comments-new-comment', 'The comments comment textarea is present');
    // Verify the submit button in the form exists
    casper.test.assertExists('.comments-new-comment-form button[type="submit"]', 'The comments submit button is present');
};

casper.start('http://test.oae.com', function() {
    // Create a user to test comments with
    var user1 = null;
    userUtil().createUsers(1, function(users) {
        user1 = users[0];
    });

    // Login with that user
    casper.then(function() {
        userUtil().doLogIn(user1.username, 'password');
    });

    // Create a content item
    casper.then(function() {
        contentUtil().createFile(function(contentUrl) {
            // Redirect to the content page
            casper.thenOpen('http://test.oae.com' + contentUrl, function() {
                // Verify comments elements
                casper.then(function() {
                    casper.echo('Verify comments elements present', 'INFO');
                    verifyCommentsElements();
                });
            });
        });
    });

    // Log user out
    casper.then(function() {
        userUtil().doLogOut();
    });
});

casper.run(function() {
    this.test.done();
});
